<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ナンプレ ソルバー</title>
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    background: #f4f4f4;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 30px;
  }
  h1 {
    margin-bottom: 20px;
  }
  table {
    border-collapse: collapse;
  }
  td {
    border: 1px solid #999;
    width: 40px;
    height: 40px;
    text-align: center;
    background: #fff;
  }
  input {
    width: 38px;
    height: 38px;
    text-align: center;
    font-size: 18px;
    border: none;
  }
  /* 太い枠線で3x3ブロックを区切る */
  td:nth-child(3n) {
    border-right: 2px solid #000;
  }
  tr:nth-child(3n) td {
    border-bottom: 2px solid #000;
  }
  button {
    margin: 15px 5px;
    padding: 10px 20px;
    font-size: 16px;
  }
</style>
</head>
<body>
<h1>ナンプレ ソルバー</h1>

<table id="sudoku">
  <!-- 9x9の入力グリッドを自動生成 -->
</table>

<div>
  <button onclick="solve()">解く</button>
  <button onclick="clearBoard()">クリア</button>
</div>

<script>
const table = document.getElementById("sudoku");

// 9x9のマスを作成
for (let r = 0; r < 9; r++) {
  const row = document.createElement("tr");
  for (let c = 0; c < 9; c++) {
    const cell = document.createElement("td");
    const input = document.createElement("input");
    input.setAttribute("type", "text");
    input.setAttribute("maxlength", "1");
    input.dataset.row = r;
    input.dataset.col = c;
    input.oninput = (e) => {
      e.target.value = e.target.value.replace(/[^1-9]/g, "");
    };
    cell.appendChild(input);
    row.appendChild(cell);
  }
  table.appendChild(row);
}

// 盤面を取得
function getBoard() {
  const board = [];
  for (let r = 0; r < 9; r++) {
    const row = [];
    for (let c = 0; c < 9; c++) {
      const val = document.querySelector(`input[data-row='${r}'][data-col='${c}']`).value;
      row.push(val === "" ? 0 : parseInt(val));
    }
    board.push(row);
  }
  return board;
}

// 盤面をセット
function setBoard(board) {
  for (let r = 0; r < 9; r++) {
    for (let c = 0; c < 9; c++) {
      document.querySelector(`input[data-row='${r}'][data-col='${c}']`).value =
        board[r][c] === 0 ? "" : board[r][c];
    }
  }
}

// 有効性チェック
function isValid(board, row, col, num) {
  for (let x = 0; x < 9; x++) {
    if (board[row][x] === num || board[x][col] === num) return false;
  }
  const startRow = Math.floor(row / 3) * 3;
  const startCol = Math.floor(col / 3) * 3;
  for (let r = 0; r < 3; r++) {
    for (let c = 0; c < 3; c++) {
      if (board[startRow + r][startCol + c] === num) return false;
    }
  }
  return true;
}

// バックトラックで解く
function solveSudoku(board) {
  for (let row = 0; row < 9; row++) {
    for (let col = 0; col < 9; col++) {
      if (board[row][col] === 0) {
        for (let num = 1; num <= 9; num++) {
          if (isValid(board, row, col, num)) {
            board[row][col] = num;
            if (solveSudoku(board)) return true;
            board[row][col] = 0;
          }
        }
        return false;
      }
    }
  }
  return true;
}

function solve() {
  const board = getBoard();
  if (solveSudoku(board)) {
    setBoard(board);
    alert("解けました！");
  } else {
    alert("解けませんでした。入力を確認してください。");
  }
}

function clearBoard() {
  document.querySelectorAll("input").forEach((i) => (i.value = ""));
}
</script>
</body>
</html>
